# ç®—æ³•ä¼˜åŒ– - å¿«é€Ÿå¼€å§‹æŒ‡å—

**ç”Ÿæˆæ—¶é—´**: 2025-10-20
**ä¼˜åŒ–ç‰ˆæœ¬**: v1.0

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. å®‰è£…ä¾èµ–

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# å®‰è£…æ ¸å¿ƒä¾èµ–(å¿…éœ€)
pip install numpy pandas scipy scikit-learn

# å¯é€‰: å®‰è£…pykrigeè·å¾—çœŸæ­£çš„å…‹é‡Œé‡‘æ’å€¼
pip install pykrige

# æˆ–ä½¿ç”¨requirementsæ–‡ä»¶ä¸€é”®å®‰è£…
pip install -r requirements-algorithm.txt
```

### 2. éªŒè¯å®‰è£…

```bash
# æµ‹è¯•å¯¼å…¥
python -c "from interpolation import get_interpolator; print('âœ… æ’å€¼æ¨¡å—åŠ è½½æˆåŠŸ')"
python -c "from key_strata_calculator import KeyStrataCalculator; print('âœ… å…³é”®å±‚æ¨¡å—åŠ è½½æˆåŠŸ')"
python -c "from data_validation import validate_geological_data; print('âœ… æ•°æ®éªŒè¯æ¨¡å—åŠ è½½æˆåŠŸ')"

# å¯é€‰: æµ‹è¯•pykrige
python -c "import pykrige; print('âœ… pykrigeå·²å®‰è£…,æ”¯æŒçœŸæ­£çš„å…‹é‡Œé‡‘æ’å€¼')"
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
# å·²é›†æˆåˆ°ç°æœ‰API,æ— éœ€é¢å¤–é…ç½®
cd backend
uvicorn server:app --reload --host 0.0.0.0 --port 8000

# æˆ–ä½¿ç”¨Pythonç›´æ¥è¿è¡Œ
python server.py
```

---

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: ä½¿ç”¨æ™ºèƒ½æ’å€¼

```python
from interpolation import interpolate_smart
import numpy as np

# å‡†å¤‡æ•°æ®
x = np.array([0, 1, 2, 3, 4])
y = np.array([0, 1, 2, 3, 4])
z = np.array([1.0, 2.5, 2.0, 3.5, 4.0])

# æ’å€¼ç½‘æ ¼
xi = np.linspace(0, 4, 20)
yi = np.linspace(0, 4, 20)
XI, YI = np.meshgrid(xi, yi)
xi_flat = XI.flatten()
yi_flat = YI.flatten()

# æ™ºèƒ½æ’å€¼(è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ–¹æ³•)
z_pred, metadata = interpolate_smart(x, y, z, xi_flat, yi_flat, method='auto')

print(f"ä½¿ç”¨æ–¹æ³•: {metadata['method_used']}")
print(f"æ•°æ®è´¨é‡: {metadata['data_quality']}")
print(f"æ•°æ®ç‚¹æ•°: {metadata['n_points']}")
print(f"å¼‚å¸¸å€¼å·²ç§»é™¤: {metadata['outliers_removed']}ä¸ª")
```

### ç¤ºä¾‹2: å…‹é‡Œé‡‘æ’å€¼

```python
from interpolation import get_interpolator

interpolator = get_interpolator()

# æ™®é€šå…‹é‡Œé‡‘æ’å€¼
z_pred = interpolator.ordinary_kriging(
    x, y, z, xi_flat, yi_flat,
    variogram_model='spherical'  # å¯é€‰: spherical, exponential, gaussian, linear
)

print(f"æ’å€¼å®Œæˆ,ç»“æœå½¢çŠ¶: {z_pred.shape}")
```

### ç¤ºä¾‹3: æ’å€¼éªŒè¯

```python
from interpolation import validate_interpolation
from scipy.interpolate import griddata

# å®šä¹‰æ’å€¼æ–¹æ³•
def my_method(x_train, y_train, z_train, x_test, y_test):
    return griddata((x_train, y_train), z_train, (x_test, y_test), method='cubic')

# äº¤å‰éªŒè¯
results = validate_interpolation(x, y, z, my_method, k_folds=5)

print(f"MAE:  {results['mae']:.4f}")
print(f"RMSE: {results['rmse']:.4f}")
print(f"RÂ²:   {results['r2']:.4f}")
print(f"95%ç½®ä¿¡åŒºé—´: [{results['confidence_low']:.2f}, {results['confidence_high']:.2f}]")
```

### ç¤ºä¾‹4: æ•°æ®éªŒè¯

```python
from data_validation import validate_geological_data
import pandas as pd

# å‡†å¤‡æ•°æ®
df = pd.DataFrame({
    'å²©å±‚åç§°': ['ç ‚å²©', 'æ³¥å²©', 'ç…¤å±‚', 'ç°å²©'],
    'åšåº¦/m': [5.2, 3.1, 2.0, 8.5],
    'å¼¹æ€§æ¨¡é‡/GPa': [22.0, 8.0, 5.0, 35.0],
    'å®¹é‡/kNÂ·m-3': [25.5, 20.0, 14.0, 27.0],
    'æŠ—æ‹‰å¼ºåº¦/MPa': [3.2, 1.5, 0.8, 5.5]
})

# éªŒè¯å¹¶è‡ªåŠ¨ä¿®å¤
df_clean, result = validate_geological_data(df, strict=False, auto_fix=True)

print(f"éªŒè¯ç»“æœ: {'âœ… é€šè¿‡' if result.is_valid else 'âŒ å¤±è´¥'}")
print(f"é”™è¯¯æ•°: {len(result.errors)}")
print(f"è­¦å‘Šæ•°: {len(result.warnings)}")
print(f"ä¿®å¤æ•°: {result.fixed_count}")

# æ‰“å°è¯¦ç»†ä¿¡æ¯
for error in result.errors:
    print(f"  âŒ {error}")
for warning in result.warnings:
    print(f"  âš ï¸  {warning}")
```

### ç¤ºä¾‹5: å…³é”®å±‚è®¡ç®—

```python
from key_strata_calculator import KeyStrataCalculator
import pandas as pd

# å‡†å¤‡å²©å±‚æ•°æ®
df_strata = pd.DataFrame({
    'å²©å±‚åç§°': ['ç»†ç ‚å²©', 'æ³¥å²©', 'ä¸­ç ‚å²©', 'ç²—ç ‚å²©', 'ç°å²©'],
    'åšåº¦/m': [4.5, 2.0, 6.8, 5.2, 10.0],
    'å¼¹æ€§æ¨¡é‡/GPa': [18.0, 8.0, 22.0, 25.0, 35.0],
    'å®¹é‡/kNÂ·m-3': [24.5, 20.0, 25.5, 26.0, 27.5],
    'æŠ—æ‹‰å¼ºåº¦/MPa': [2.8, 1.2, 3.5, 4.0, 5.5]
})

# ç…¤å±‚æ•°æ®
coal_df = pd.DataFrame({'åšåº¦/m': [2.5]})

# è®¡ç®—å…³é”®å±‚
calculator = KeyStrataCalculator()
key_strata = calculator.calculate(df_strata, coal_df)

# æ‰“å°ç»“æœ
print("è¯†åˆ«çš„å…³é”®å±‚:")
for ks in key_strata:
    print(f"  {ks['SK_Label']:8s} | {ks['å²©æ€§']:8s} | åšåº¦: {ks['åšåº¦']:5.2f}m | è·ç…¤å±‚: {ks['è·ç…¤å±‚è·ç¦»']:5.2f}m")
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### è¿è¡Œæ€§èƒ½æµ‹è¯•

```python
import time
import numpy as np
from interpolation import interpolate_smart

# ç”Ÿæˆæµ‹è¯•æ•°æ®
np.random.seed(42)
x = np.random.rand(100) * 100
y = np.random.rand(100) * 100
z = np.sin(x/10) + np.cos(y/10) + np.random.rand(100) * 0.5

xi = np.linspace(0, 100, 50)
yi = np.linspace(0, 100, 50)
XI, YI = np.meshgrid(xi, yi)
xi_flat = XI.flatten()
yi_flat = YI.flatten()

# æ€§èƒ½æµ‹è¯•
start = time.time()
z_pred, metadata = interpolate_smart(x, y, z, xi_flat, yi_flat, method='auto')
elapsed = time.time() - start

print(f"âœ… æ’å€¼å®Œæˆ")
print(f"   æ–¹æ³•: {metadata['method_used']}")
print(f"   è€—æ—¶: {elapsed*1000:.2f} ms")
print(f"   æ•°æ®ç‚¹: {metadata['n_points']}")
print(f"   è¾“å‡ºç‚¹: {len(z_pred)}")
```

---

## ğŸ”§ é…ç½®é€‰é¡¹

### æ’å€¼æ–¹æ³•é€‰æ‹©

```python
# å¯ç”¨æ–¹æ³•:
methods = [
    'auto',              # è‡ªåŠ¨é€‰æ‹©(æ¨è)
    'nearest',           # æœ€è¿‘é‚»
    'linear',            # çº¿æ€§æ’å€¼
    'cubic',             # ä¸‰æ¬¡æ ·æ¡
    'kriging',           # æ™®é€šå…‹é‡Œé‡‘
    'anisotropic',       # å„å‘å¼‚æ€§
    'idw'               # åè·ç¦»åŠ æƒ
]

# ä½¿ç”¨ç¤ºä¾‹
z_pred, metadata = interpolate_smart(x, y, z, xi, yi, method='kriging')
```

### å…‹é‡Œé‡‘å˜å·®å‡½æ•°

```python
# å¯ç”¨æ¨¡å‹:
variogram_models = [
    'spherical',         # çƒçŠ¶æ¨¡å‹(é»˜è®¤)
    'exponential',       # æŒ‡æ•°æ¨¡å‹
    'gaussian',          # é«˜æ–¯æ¨¡å‹
    'linear'            # çº¿æ€§æ¨¡å‹
]

# ä½¿ç”¨ç¤ºä¾‹
z_pred = interpolator.ordinary_kriging(
    x, y, z, xi, yi,
    variogram_model='exponential'
)
```

### æ•°æ®éªŒè¯ä¸¥æ ¼æ¨¡å¼

```python
# éä¸¥æ ¼æ¨¡å¼(é»˜è®¤): è‡ªåŠ¨ä¿®å¤å¹¶ç»™å‡ºè­¦å‘Š
df_clean, result = validate_geological_data(df, strict=False, auto_fix=True)

# ä¸¥æ ¼æ¨¡å¼: å‘ç°é—®é¢˜ç«‹å³æŠ›å‡ºå¼‚å¸¸
try:
    df_clean, result = validate_geological_data(df, strict=True, auto_fix=False)
except ValueError as e:
    print(f"éªŒè¯å¤±è´¥: {e}")
```

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1: æ— æ³•å¯¼å…¥pykrige

**ç°è±¡**:
```
ImportError: No module named 'pykrige'
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å®‰è£…pykrige
pip install pykrige

# å¦‚æœå®‰è£…å¤±è´¥,ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨é«˜æ–¯RBFè¿‘ä¼¼,ä»å¯æ­£å¸¸è¿è¡Œ
# ä¸å½±å“å…¶ä»–åŠŸèƒ½
```

### é—®é¢˜2: æ’å€¼ç»“æœå…¨æ˜¯NaN

**åŸå› **: æ•°æ®ç‚¹å¤ªå°‘æˆ–åˆ†å¸ƒä¸åˆç†

**è§£å†³æ–¹æ¡ˆ**:
```python
# ä½¿ç”¨æ™ºèƒ½æ’å€¼,ä¼šè‡ªåŠ¨å¤„ç†
z_pred, metadata = interpolate_smart(x, y, z, xi, yi, method='auto')

# æˆ–å¼ºåˆ¶ä½¿ç”¨æœ€è¿‘é‚»æ’å€¼
z_pred, metadata = interpolate_smart(x, y, z, xi, yi, method='nearest')
```

### é—®é¢˜3: å…³é”®å±‚è®¡ç®—è¿”å›ç©ºåˆ—è¡¨

**åŸå› **: è¾“å…¥æ•°æ®ä¸ç¬¦åˆè¦æ±‚

**è§£å†³æ–¹æ¡ˆ**:
```python
# ç¡®ä¿æ•°æ®åŒ…å«å¿…éœ€åˆ—
required_cols = ['å²©å±‚åç§°', 'åšåº¦/m', 'å¼¹æ€§æ¨¡é‡/GPa', 'å®¹é‡/kNÂ·m-3', 'æŠ—æ‹‰å¼ºåº¦/MPa']

# æ£€æŸ¥æ•°æ®
print(df_strata.columns)
print(df_strata.head())

# ç¡®ä¿ç…¤å±‚æ•°æ®ä¸ä¸ºç©º
print(coal_df['åšåº¦/m'].iloc[0])
```

### é—®é¢˜4: æ•°æ®éªŒè¯æŠ¥å‘Šå¤ªå¤šè­¦å‘Š

**åŸå› **: æ•°æ®è´¨é‡é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
```python
# æŸ¥çœ‹å…·ä½“è­¦å‘Š
for warning in result.warnings:
    print(warning)

# å¦‚æœæ˜¯åˆç†çš„è­¦å‘Š(å¦‚æ³¥å²©å¼ºåº¦ç•¥é«˜),å¯ä»¥å¿½ç•¥
# å¦‚æœæ˜¯ä¸¥é‡é—®é¢˜(å¦‚åšåº¦ä¸ºè´Ÿ),éœ€è¦ä¿®æ­£åŸå§‹æ•°æ®
```

---

## ğŸ“– APIå‚è€ƒ

è¯¦è§: [`docs/ç®—æ³•ä¸ä¸šåŠ¡é€»è¾‘ä¼˜åŒ–æŠ¥å‘Š.md`](docs/ç®—æ³•ä¸ä¸šåŠ¡é€»è¾‘ä¼˜åŒ–æŠ¥å‘Š.md)

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… è¿è¡Œç¤ºä¾‹ä»£ç æµ‹è¯•åŠŸèƒ½
2. âœ… æŸ¥çœ‹å®Œæ•´æ–‡æ¡£äº†è§£é«˜çº§ç”¨æ³•
3. âœ… ç¼–å†™å•å…ƒæµ‹è¯•ç¡®ä¿ä»£ç è´¨é‡
4. âœ… åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”ç”¨ä¼˜åŒ–ç®—æ³•
5. âœ… ç›‘æ§æ€§èƒ½æå‡æ•ˆæœ

---

## ğŸ“ æ”¯æŒ

- ğŸ“„ å®Œæ•´æ–‡æ¡£: `docs/ç®—æ³•ä¸ä¸šåŠ¡é€»è¾‘ä¼˜åŒ–æŠ¥å‘Š.md`
- ğŸ› é—®é¢˜åé¦ˆ: é¡¹ç›®issueé¡µé¢
- ğŸ’¬ æŠ€æœ¯äº¤æµ: å¼€å‘å›¢é˜Ÿ

---

**ç¥ä½¿ç”¨æ„‰å¿«!** ğŸ‰

#!/bin/bash
# ============================================================================
# 服务器端快速更新脚本（仅重启，不重新构建）
# ============================================================================
# 用途: 拉取代码变更并重启容器（适合配置文件、Python代码等热更新）
# 使用: ./server-quick-update.sh
# ============================================================================

set -e

echo "⚡ 快速更新模式"
echo "=========================================="

PROJECT_DIR="/var/www/xitong"
cd "$PROJECT_DIR" || exit 1

# 拉取代码
echo "📥 拉取最新代码..."
git fetch origin
git reset --hard origin/master
echo "✓ 代码已更新"

# 重启容器（不重新构建）
echo ""
echo "🔄 重启容器..."
docker compose restart

# 等待服务就绪
echo ""
echo "⏳ 等待服务就绪..."
sleep 5

# 检查状态
echo ""
docker compose ps

echo ""
echo "✅ 快速更新完成！"
echo "=========================================="

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>测试CSV转换</title>
</head>
<body>
    <h1>测试CSV转换逻辑</h1>
    <pre id="output"></pre>
    
    <script>
        // 模拟全局数据
        const testData = [
            {
                "钻孔名": "BK-1",
                "岩层": "粗砂岩",
                "厚度/m": 5.2,
                "弹性模量/GPa": 15.5,
                "容重/kN·m-3": 25.0,
                "抗拉强度/MPa": 4.5,
                "数据来源": "BK-1.csv"
            },
            {
                "钻孔名": "BK-1",
                "岩层": "3#煤",
                "厚度/m": 2.5,
                "弹性模量/GPa": 2.8,
                "容重/kN·m-3": 13.5,
                "抗拉强度/MPa": 0.5,
                "数据来源": "BK-1.csv"
            },
            {
                "钻孔名": "BK-1",
                "岩层": "泥岩",
                "厚度/m": 3.0,
                "弹性模量/GPa": 8.0,
                "容重/kN·m-3": 22.0,
                "抗拉强度/MPa": 2.0,
                "数据来源": "BK-1.csv"
            }
        ];
        
        const columns = ["钻孔名", "岩层", "厚度/m", "弹性模量/GPa", "容重/kN·m-3", "抗拉强度/MPa", "数据来源"];
        
        // 转换函数
        const convertTableDataToCSV = (data, columns) => {
            if (!data || !data.length) return '';
            const header = columns.join(',');
            const rows = data.map(record => 
                columns.map(col => {
                    const value = record[col];
                    if (value === null || value === undefined) return '';
                    const strValue = String(value);
                    return strValue.includes(',') ? `"${strValue}"` : strValue;
                }).join(',')
            );
            return [header, ...rows].join('\n');
        };
        
        const csv = convertTableDataToCSV(testData, columns);
        
        const output = document.getElementById('output');
        output.textContent = `列名: ${columns.join(', ')}\n\n`;
        output.textContent += `数据行数: ${testData.length}\n\n`;
        output.textContent += `生成的CSV:\n${csv}\n\n`;
        output.textContent += `CSV长度: ${csv.length} 字节`;
        
        console.log('CSV内容:', csv);
    </script>
</body>
</html>

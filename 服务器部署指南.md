# ğŸš€ æœåŠ¡å™¨éƒ¨ç½²æŒ‡å— - å··é“æ”¯æŠ¤è®¡ç®—åŠŸèƒ½æ›´æ–°

## ğŸ“‹ æœ¬æ¬¡æ›´æ–°å†…å®¹

### æ–°å¢åŠŸèƒ½
1. **å··é“æ”¯æŠ¤è®¡ç®—æ¨¡å—**
   - å®Œæ•´çš„å··é“æ”¯æŠ¤è®¡ç®— API
   - å•æ¬¡è®¡ç®—å’Œæ‰¹é‡è®¡ç®—
   - Excel å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

2. **å…¬å¼ä¿®æ­£**
   - âœ… hatï¼ˆå‹åŠ›æ‹±é«˜åº¦ï¼‰å…¬å¼ï¼šæ·»åŠ  f_top å‚æ•°
   - âœ… ç­‰æ•ˆåœ†åŠå¾„å…¬å¼ï¼šr = âˆš(aÂ² + bÂ²)
   - âœ… é”šç´¢é”šå›ºé•¿åº¦å…¬å¼ï¼šLm = Q / (2Ï€Rcâ‚€)

3. **å‰ç«¯ç•Œé¢**
   - å··é“æ”¯æŠ¤è®¡ç®—é¡µé¢
   - æ‰¹é‡é˜Ÿåˆ—ç®¡ç†
   - å†å²è®°å½•
   - ç»Ÿè®¡åˆ†æ
   - ç»“æœå¯¹æ¯”

### ä¿®æ”¹çš„æ–‡ä»¶
```
backend/
  â”œâ”€â”€ tunnel_support.py         # æ ¸å¿ƒè®¡ç®—æ¨¡å—ï¼ˆæ–°å¢+ä¿®æ”¹ï¼‰
  â”œâ”€â”€ server.py                 # API æ¥å£ï¼ˆæ·»åŠ  f_top å‚æ•°ï¼‰
  â””â”€â”€ requirements.txt          # ä¾èµ–å·²åŒ…å«ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

frontend/
  â””â”€â”€ src/components/
      â””â”€â”€ TunnelSupportView.vue # å··é“æ”¯æŠ¤ç•Œé¢ï¼ˆæ–°å¢+ä¿®æ”¹ï¼‰
```

---

## âœ… Docker æ–‡ä»¶æ£€æŸ¥

### å½“å‰ Docker é…ç½®çŠ¶æ€

1. **backend/Dockerfile** âœ…
   - Python 3.11-slim
   - æ‰€æœ‰ä¾èµ–å·²åœ¨ requirements.txt ä¸­
   - æ— éœ€ä¿®æ”¹

2. **frontend/Dockerfile** âœ…
   - Node 18-alpine æ„å»º
   - Nginx 1.25-alpine è¿è¡Œ
   - æ— éœ€ä¿®æ”¹

3. **docker-compose.yml** âœ…
   - åç«¯ç«¯å£ï¼š8000
   - å‰ç«¯ç«¯å£ï¼š80
   - æ•°æ®å·æŒ‚è½½æ­£ç¡®
   - æ— éœ€ä¿®æ”¹

### ç»“è®º
**âœ… æ‰€æœ‰ Docker æ–‡ä»¶éƒ½ä¸éœ€è¦ä¿®æ”¹ï¼**

---

## ğŸš¢ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³• 1: å®Œæ•´é‡æ–°éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. åœæ­¢ç°æœ‰å®¹å™¨
docker-compose down

# 2. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# 3. é‡æ–°æ„å»ºé•œåƒï¼ˆå¼ºåˆ¶ä¸ä½¿ç”¨ç¼“å­˜ï¼‰
docker-compose build --no-cache

# 4. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 5. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### æ–¹æ³• 2: å¿«é€Ÿæ›´æ–°ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin master

# 2. é‡æ–°æ„å»ºï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰
docker-compose build

# 3. é‡å¯æœåŠ¡
docker-compose restart

# 4. éªŒè¯çŠ¶æ€
docker-compose ps
```

### æ–¹æ³• 3: ä»…æ›´æ–°åç«¯ï¼ˆå¦‚æœåªæ”¹äº†åç«¯ï¼‰

```bash
# 1. åœæ­¢åç«¯å®¹å™¨
docker-compose stop backend

# 2. é‡æ–°æ„å»ºåç«¯
docker-compose build backend

# 3. å¯åŠ¨åç«¯
docker-compose up -d backend

# 4. æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs -f backend
```

---

## ğŸ§ª éƒ¨ç½²åéªŒè¯

### 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
```bash
docker-compose ps
```

åº”è¯¥æ˜¾ç¤ºï¼š
```
NAME                  STATUS              PORTS
mining-backend        Up                  0.0.0.0:8000->8000/tcp
mining-frontend       Up                  0.0.0.0:80->80/tcp
```

### 2. æ£€æŸ¥åç«¯å¥åº·çŠ¶æ€
```bash
curl http://localhost:8000/api/health
```

åº”è¯¥è¿”å›ï¼š
```json
{
  "status": "healthy",
  "message": "ç³»ç»Ÿè¿è¡Œæ­£å¸¸",
  ...
}
```

### 3. æµ‹è¯•å··é“æ”¯æŠ¤è®¡ç®— API
```bash
curl -X POST http://localhost:8000/api/tunnel-support/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "B": 4.8,
    "H": 3.2,
    "K": 1.0,
    "depth": 200,
    "gamma": 18.0,
    "C": 0.5,
    "phi": 32.47,
    "f_top": 2.2
  }'
```

åº”è¯¥è¿”å›åŒ…å« `hat: 1.889` çš„è®¡ç®—ç»“æœã€‚

### 4. è®¿é—®å‰ç«¯é¡µé¢
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
- `http://your-server-ip/`
- ç‚¹å‡»"å··é“æ”¯æŠ¤è®¡ç®—"èœå•
- è¾“å…¥å‚æ•°å¹¶æµ‹è¯•è®¡ç®—åŠŸèƒ½

### 5. æŸ¥çœ‹æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—
docker-compose logs

# åªçœ‹åç«¯æ—¥å¿—
docker-compose logs backend

# å®æ—¶æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f --tail=100
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### è¿›å…¥å®¹å™¨å†…éƒ¨
```bash
# è¿›å…¥åç«¯å®¹å™¨
docker exec -it mining-backend /bin/bash

# è¿›å…¥å‰ç«¯å®¹å™¨
docker exec -it mining-frontend /bin/sh
```

### æ£€æŸ¥åç«¯æ–‡ä»¶
```bash
docker exec mining-backend ls -la /app/
docker exec mining-backend cat /app/tunnel_support.py | head -20
```

### æ‰‹åŠ¨æµ‹è¯• Python ä»£ç 
```bash
docker exec -it mining-backend python -c "
from tunnel_support import TunnelSupportCalculator
calc = TunnelSupportCalculator()
result = calc.calculate_complete({
    'B': 4.8, 'H': 3.2, 'K': 1.0, 'depth': 200,
    'gamma': 18.0, 'C': 0.5, 'phi': 32.47, 'f_top': 2.2
})
print('hat =', result['basic']['hat'])
"
```

åº”è¯¥è¾“å‡ºï¼š`hat = 1.889`

---

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜ 0: ğŸš¨ é¡µé¢æ— æ³•æ‰“å¼€ï¼ˆæ•°æ®åº“ã€åœ°è´¨å»ºæ¨¡ã€ç§‘ç ”ç»˜å›¾ç­‰é¡µé¢ï¼‰

**ç—‡çŠ¶ï¼š**
- âœ… é¦–é¡µå¯ä»¥è®¿é—®
- âœ… åç«¯ API æ­£å¸¸ (`/api/health` è¿”å› 200)
- âŒ ç‚¹å‡»èœå•åé¡µé¢ç©ºç™½æˆ–æ— å“åº”
- âŒ æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º 404 é”™è¯¯ï¼ˆåŠ è½½ .js æ–‡ä»¶å¤±è´¥ï¼‰

**åŸå› ï¼š**
å‰ç«¯æ„å»ºæ—¶**ä»£ç åˆ†å‰²å¤±è´¥**ï¼Œæ‡’åŠ è½½çš„ç»„ä»¶æ–‡ä»¶æ²¡æœ‰ç”Ÿæˆã€‚

è·¯ç”±é…ç½®ä½¿ç”¨äº†æ‡’åŠ è½½ï¼š
```javascript
const DatabaseViewerView = () => import(/* webpackChunkName: "database" */ '../components/DatabaseViewerView.vue')
```

ä½†æ„å»ºååªæœ‰ `app.js` å’Œ `chunk-vendors.js`ï¼Œç¼ºå°‘ `database.js`ã€`modeling.js` ç­‰æ–‡ä»¶ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

1. **ä½¿ç”¨è‡ªåŠ¨ä¿®å¤è„šæœ¬ï¼ˆæ¨èï¼‰ï¼š**
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /path/to/xitong
bash scripts/fix_server_pages.sh
```

2. **æ‰‹åŠ¨ä¿®å¤ï¼š**
```bash
# åœæ­¢å®¹å™¨
docker-compose down

# å¼ºåˆ¶é‡æ–°æ„å»ºå‰ç«¯ï¼ˆå¿…é¡»ä½¿ç”¨ --no-cacheï¼‰
docker-compose build --no-cache frontend

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# éªŒè¯ä¿®å¤
docker exec $(docker-compose ps -q frontend) ls /usr/share/nginx/html/js/
# åº”è¯¥çœ‹åˆ°: database.xxx.js, modeling.xxx.js, visualization.xxx.js ç­‰æ–‡ä»¶
```

3. **éªŒè¯ä¿®å¤æ˜¯å¦æˆåŠŸï¼š**
```bash
# è¿›å…¥å‰ç«¯å®¹å™¨
docker exec -it xitong-frontend-1 sh

# æŸ¥çœ‹ js æ–‡ä»¶åˆ—è¡¨
ls -lh /usr/share/nginx/html/js/

# åº”è¯¥åŒ…å«è¿™äº›æ–‡ä»¶ï¼š
# - app.xxxxx.js
# - chunk-vendors.xxxxx.js
# - chunk-echarts.xxxxx.js
# - chunk-element-plus.xxxxx.js
# - database.xxxxx.js          â† å…³é”®
# - modeling.xxxxx.js          â† å…³é”®
# - visualization.xxxxx.js     â† å…³é”®
# - key-stratum.xxxxx.js
# - borehole.xxxxx.js
# - tunnel-support.xxxxx.js
```

4. **æµ‹è¯•é¡µé¢è®¿é—®ï¼š**
- http://39.97.168.66/database-viewer
- http://39.97.168.66/geological-modeling
- http://39.97.168.66/visualization

**è¯¦ç»†ä¿®å¤æ–‡æ¡£ï¼š** å‚è§ `æœåŠ¡å™¨é¡µé¢æ— æ³•æ‰“å¼€ä¿®å¤æŒ‡å—.md`

---

### é—®é¢˜ 1: å®¹å™¨å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
docker-compose logs backend

# å¯èƒ½åŸå› ï¼š
# - ç«¯å£è¢«å ç”¨ï¼ˆ8000 æˆ– 80ï¼‰
# - ä¾èµ–å®‰è£…å¤±è´¥
# - é…ç½®æ–‡ä»¶é”™è¯¯
```

### é—®é¢˜ 2: f_top å‚æ•°æœªç”Ÿæ•ˆ
```bash
# æ£€æŸ¥åç«¯ä»£ç 
docker exec mining-backend grep -n "f_top" /app/server.py
docker exec mining-backend grep -n "f_top" /app/tunnel_support.py

# åº”è¯¥èƒ½æ‰¾åˆ°ç›¸å…³ä»£ç 
```

### é—®é¢˜ 3: å‰ç«¯æ— æ³•è®¿é—®åç«¯
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
docker network ls
docker network inspect xitong_default

# æ£€æŸ¥åç«¯æ˜¯å¦ç›‘å¬æ­£ç¡®ç«¯å£
docker exec mining-backend netstat -tlnp | grep 8000
```

### é—®é¢˜ 4: è®¡ç®—ç»“æœä¸å¯¹
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„è°ƒè¯•ä¿¡æ¯
docker-compose logs backend | grep "DEBUG"

# åº”è¯¥èƒ½çœ‹åˆ°ï¼š
# [DEBUG] æ¥æ”¶åˆ°çš„å‚æ•°: {...}
# [DEBUG] f_top å€¼: 2.2
# [DEBUG] è®¡ç®—ç»“æœ hat: 1.889
```

---

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœæ–°ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿå›æ»šï¼š

```bash
# 1. å›åˆ°ä¹‹å‰çš„ git ç‰ˆæœ¬
git log --oneline -10  # æŸ¥çœ‹å†å²æäº¤
git checkout <ä¹‹å‰çš„commit-hash>

# 2. é‡æ–°æ„å»º
docker-compose build

# 3. é‡å¯æœåŠ¡
docker-compose up -d

# æˆ–è€…ç›´æ¥ä½¿ç”¨ä¹‹å‰çš„é•œåƒï¼ˆå¦‚æœæœ‰tagï¼‰
docker-compose down
docker tag mining-system-backend:latest mining-system-backend:backup
# ... ç„¶åæ¢å¤æ—§é•œåƒ
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨ Docker BuildKit
```bash
# åœ¨æ„å»ºæ—¶ä½¿ç”¨ BuildKit
DOCKER_BUILDKIT=1 docker-compose build
```

### 2. é…ç½®èµ„æºé™åˆ¶ï¼ˆå¯é€‰ï¼‰
åœ¨ `docker-compose.yml` ä¸­æ·»åŠ ï¼š
```yaml
services:
  backend:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G
```

### 3. å¯ç”¨æ—¥å¿—è½®è½¬
```yaml
services:
  backend:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰ï¼š
- [ ] ä»£ç å·²æäº¤åˆ° git
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [ ] å¤‡ä»½å½“å‰è¿è¡Œçš„å®¹å™¨

éƒ¨ç½²ä¸­ï¼š
- [ ] åœæ­¢æ—§å®¹å™¨
- [ ] æ‹‰å–æœ€æ–°ä»£ç 
- [ ] æ„å»ºæ–°é•œåƒ
- [ ] å¯åŠ¨æ–°å®¹å™¨

éƒ¨ç½²åï¼š
- [ ] å®¹å™¨çŠ¶æ€æ­£å¸¸
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡
- [ ] API æµ‹è¯•é€šè¿‡
- [ ] å‰ç«¯é¡µé¢å¯è®¿é—®
- [ ] å··é“æ”¯æŠ¤è®¡ç®—åŠŸèƒ½æµ‹è¯•
- [ ] æ—¥å¿—æ— é”™è¯¯

---

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs`
2. æ£€æŸ¥å®¹å™¨çŠ¶æ€ï¼š`docker-compose ps`
3. è¿›å…¥å®¹å™¨è°ƒè¯•ï¼š`docker exec -it mining-backend /bin/bash`

ç¥éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰

import React, { useState, useEffect } from 'react';
import { 
  Layers, 
  Settings, 
  Hexagon, 
  CheckCircle2, 
  Cpu, 
  Ruler, 
  PenTool, 
  FileText, 
  Download, 
  Sparkles, 
  ChevronRight, 
  ChevronLeft,
  Zap, 
  Maximize2,
  Printer,
  Share2,
  Save,
  ArrowRight,
  PanelLeftClose,
  PanelLeftOpen,
  PanelRightClose,
  PanelRightOpen,
  X,
  MousePointer2,
  Move
} from 'lucide-react';

// --- Styles (Helios Prism System - Restored) ---
const styles = `
  @keyframes gradient-flow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
  }
  @keyframes draw-line {
    to { stroke-dashoffset: 0; }
  }
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }
  
  /* Original Prism Background */
  .bg-aurora {
    background: radial-gradient(circle at 0% 0%, rgba(238, 242, 255, 0.9) 0%, rgba(255, 255, 255, 0) 50%),
                radial-gradient(circle at 100% 0%, rgba(224, 242, 254, 0.9) 0%, rgba(255, 255, 255, 0) 50%),
                radial-gradient(circle at 100% 100%, rgba(240, 253, 244, 0.9) 0%, rgba(255, 255, 255, 0) 50%),
                #ffffff;
    background-size: 200% 200%;
  }
  
  /* Original Glass Morphism */
  .glass-panel {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.6);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
  }

  .glass-input {
    background: rgba(255, 255, 255, 0.5);
    border: 1px solid rgba(203, 213, 225, 0.6);
    transition: all 0.3s ease;
  }
  .glass-input:focus {
    background: rgba(255, 255, 255, 0.9);
    border-color: #8b5cf6;
    box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
    outline: none;
  }

  .text-gradient-primary {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #06b6d4 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .bg-gradient-primary {
    background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #06b6d4 100%);
  }
  
  /* CAD Specific Styles - Only for the canvas area */
  .cad-grid {
    background-size: 40px 40px;
    background-image:
      linear-gradient(to right, rgba(99, 102, 241, 0.05) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(99, 102, 241, 0.05) 1px, transparent 1px);
    background-color: #fff; /* White paper look for CAD */
  }
  
  .blueprint-line {
    stroke-dasharray: 1000;
    stroke-dashoffset: 1000;
    animation: draw-line 2s ease-out forwards;
  }

  /* Custom Scrollbar */
  .custom-scroll::-webkit-scrollbar {
    width: 6px;
  }
  .custom-scroll::-webkit-scrollbar-track {
    background: transparent;
  }
  .custom-scroll::-webkit-scrollbar-thumb {
    background-color: rgba(99, 102, 241, 0.2);
    border-radius: 20px;
  }
`;

// --- UI Components (Restored Prism Style) ---

const GlassButton = ({ children, onClick, variant = 'primary', className = '', icon: Icon, title }) => {
  const baseStyle = "relative px-4 py-2 font-bold text-sm transition-all duration-300 rounded-xl flex items-center justify-center gap-2 overflow-hidden group active:scale-95 select-none";
  
  // Restored the gradient/glass variants
  const variants = {
    primary: "bg-gradient-primary text-white shadow-[0_4px_14px_0_rgba(99,102,241,0.39)] hover:shadow-[0_6px_20px_rgba(99,102,241,0.23)] hover:-translate-y-0.5",
    secondary: "bg-white text-slate-600 border border-slate-200 hover:border-violet-300 hover:text-violet-600 hover:shadow-lg hover:shadow-violet-100",
    ghost: "bg-transparent text-slate-500 hover:bg-slate-100 p-2"
  };

  return (
    <button onClick={onClick} className={`${baseStyle} ${variants[variant]} ${className}`} title={title}>
      {variant === 'primary' && (
        <div className="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out"></div>
      )}
      {Icon && <Icon size={16} className={variant === 'primary' ? 'text-white' : ''} />}
      {children && <span className="relative z-10">{children}</span>}
    </button>
  );
};

const ParameterInput = ({ label, unit, defaultValue, min, max }) => (
  <div className="mb-4 group">
    <div className="flex justify-between mb-1.5">
      <label className="text-[10px] font-bold text-slate-500 uppercase tracking-wide group-hover:text-violet-600 transition-colors truncate pr-2">{label}</label>
      <span className="text-[10px] text-slate-400 bg-slate-100 px-1.5 rounded whitespace-nowrap">{min}-{max}{unit}</span>
    </div>
    <div className="relative">
      <input 
        type="number" 
        defaultValue={defaultValue} 
        className="glass-input w-full px-3 py-2 rounded-lg text-sm font-mono text-slate-700 font-bold"
      />
      <span className="absolute right-3 top-2 text-xs text-slate-400 font-bold pointer-events-none select-none">{unit}</span>
    </div>
  </div>
);

const SpecItem = ({ label, value }) => (
  <div className="flex justify-between items-center py-2 border-b border-slate-100 last:border-0">
    <span className="text-xs text-slate-500">{label}</span>
    <span className="text-xs font-bold text-slate-800 font-mono text-right select-all">{value}</span>
  </div>
);

// --- CAD Blueprint Canvas (Embedded in Helios Style) ---
const BlueprintCanvas = ({ isGenerating, showDesign }) => {
  return (
    <div className="absolute inset-0 cad-grid flex items-center justify-center overflow-hidden cursor-crosshair shadow-inner">
      
      {/* Pattern Definitions for CAD */}
      <svg width="0" height="0" className="absolute">
        <defs>
          <pattern id="hatch" patternUnits="userSpaceOnUse" width="4" height="4" patternTransform="rotate(45)">
            <line x1="0" y="0" x2="0" y2="4" stroke="#94a3b8" strokeWidth="1" />
          </pattern>
          <marker id="arrow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
            <path d="M0,0 L6,3 L0,6 L0,0" fill="#64748b" />
          </marker>
        </defs>
      </svg>

      {/* CAD Overlay UI - Styled nicely */}
      <div className="absolute top-6 left-6 flex flex-col gap-1 text-[10px] font-mono text-slate-400 select-none pointer-events-none bg-white/80 backdrop-blur px-2 py-1 rounded border border-slate-100">
        <span>VIEW: TOP_PLAN_01</span>
        <span>SCALE: 1:2000</span>
        <span>UNIT: METRIC (m)</span>
      </div>
      
      <div className="absolute bottom-6 left-6 text-[10px] font-mono text-slate-400 pointer-events-none bg-white/80 backdrop-blur px-2 py-1 rounded border border-slate-100">
        X: 4291.22 Y: 8821.05 Z: -450.00
      </div>

      {/* The Technical Drawing (CAD Style) */}
      <div className={`relative w-full h-full p-16 transition-all duration-1000 ${isGenerating ? 'opacity-60 blur-[1px] scale-95' : 'opacity-100 scale-100'}`}>
        {showDesign ? (
          <svg className="w-full h-full drop-shadow-lg" viewBox="0 0 800 600" preserveAspectRatio="xMidYMid meet">
            {/* Center Lines (Grid References) */}
            <line x1="50" y1="300" x2="750" y2="300" stroke="#cbd5e1" strokeWidth="1" strokeDasharray="10,5" />
            <line x1="400" y1="50" x2="400" y2="550" stroke="#cbd5e1" strokeWidth="1" strokeDasharray="10,5" />

            {/* Main Structure Group */}
            <g className="blueprint-line">
               {/* Boundary - Sharp lines for CAD feel */}
               <rect x="100" y="150" width="600" height="300" fill="none" stroke="#334155" strokeWidth="1.5" />
               
               {/* Shafts with Crosshair Symbols */}
               <g transform="translate(150, 300)">
                  <circle r="15" fill="none" stroke="#0f172a" strokeWidth="2" />
                  <line x1="-20" y1="0" x2="20" y2="0" stroke="#0f172a" strokeWidth="1" />
                  <line x1="0" y1="-20" x2="0" y2="20" stroke="#0f172a" strokeWidth="1" />
                  <text x="25" y="5" className="text-[10px] fill-slate-600 font-mono font-bold">MAIN SHAFT</text>
               </g>
               
               <g transform="translate(250, 300)">
                  <circle r="12" fill="none" stroke="#0f172a" strokeWidth="2" strokeDasharray="4,2" />
                  <line x1="-16" y1="0" x2="16" y2="0" stroke="#0f172a" strokeWidth="1" />
                  <line x1="0" y1="-16" x2="0" y2="16" stroke="#0f172a" strokeWidth="1" />
                  <text x="20" y="5" className="text-[10px] fill-slate-600 font-mono font-bold">AUX SHAFT</text>
               </g>

               {/* Roadways / Tunnels */}
               <path d="M 150 300 L 150 200 L 650 200 L 650 400 L 150 400 L 150 300" fill="none" stroke="#334155" strokeWidth="1.5" />
               
               {/* Working Faces (Hatched Areas) */}
               <rect x="350" y="200" width="100" height="200" fill="url(#hatch)" stroke="#334155" strokeWidth="1" />
               <rect x="500" y="200" width="100" height="200" fill="url(#hatch)" stroke="#334155" strokeWidth="1" />
               
               {/* Face Annotations - Sharp CAD Style */}
               <line x1="350" y1="420" x2="450" y2="420" stroke="#64748b" strokeWidth="1" markerStart="url(#arrow)" markerEnd="url(#arrow)" />
               <line x1="350" y1="415" x2="350" y2="425" stroke="#64748b" strokeWidth="1" />
               <line x1="450" y1="415" x2="450" y2="425" stroke="#64748b" strokeWidth="1" />
               <text x="400" y="435" textAnchor="middle" className="text-[10px] fill-slate-500 font-mono font-bold">100m FACE</text>
               
               <text x="400" y="300" textAnchor="middle" className="text-xs fill-slate-800 font-bold font-mono bg-white px-1">LW-101</text>
               <text x="550" y="300" textAnchor="middle" className="text-xs fill-slate-800 font-bold font-mono bg-white px-1">LW-102</text>
            </g>

            {/* Ventilation Flow Indicators (Colored CAD Lines) */}
            <g className="opacity-80">
               <path d="M 160 210 L 340 210" stroke="#0ea5e9" strokeWidth="1.5" strokeDasharray="4,2" markerEnd="url(#arrow)" />
               <path d="M 460 390 L 640 390" stroke="#ef4444" strokeWidth="1.5" strokeDasharray="4,2" markerEnd="url(#arrow)" />
            </g>

          </svg>
        ) : (
          <div className="flex flex-col items-center justify-center h-full text-slate-300">
             <div className="w-24 h-24 border-2 border-dashed border-slate-300 rounded-full flex items-center justify-center mb-4 bg-slate-50">
                <Move size={32} className="text-slate-400" />
             </div>
             <p className="text-sm font-mono font-bold text-slate-400">NO DESIGN LOADED</p>
             <p className="text-xs text-slate-400">Enter parameters and generate layout</p>
          </div>
        )}

        {/* Generating State Overlay */}
        {isGenerating && (
           <div className="absolute inset-0 flex flex-col items-center justify-center bg-white/60 backdrop-blur-[2px] z-20">
              <div className="w-16 h-16 border-4 border-violet-200 border-t-violet-600 rounded-full animate-spin mb-4"></div>
              <div className="text-violet-600 font-bold font-mono text-sm animate-pulse">AI ARCHITECT COMPUTING...</div>
           </div>
        )}
      </div>
    </div>
  );
};

// --- Main App Component ---

export default function HeliosArchitect() {
  const [isGenerating, setIsGenerating] = useState(false);
  const [showResult, setShowResult] = useState(false);
  const [leftPanelOpen, setLeftPanelOpen] = useState(true);
  const [rightPanelOpen, setRightPanelOpen] = useState(true); // Default Open

  const handleGenerate = () => {
    setIsGenerating(true);
    // Optional: Auto collapse left panel to show drawing better
    // setLeftPanelOpen(false); 
    
    setTimeout(() => {
      setIsGenerating(false);
      setShowResult(true);
    }, 2500);
  };

  return (
    <div className="min-h-screen bg-aurora text-slate-800 font-sans selection:bg-violet-200 selection:text-violet-900 flex flex-col overflow-hidden">
      <style>{styles}</style>

      {/* Header - Restored Glass Style */}
      <header className="h-16 bg-white/70 backdrop-blur-xl border-b border-white/60 flex items-center justify-between px-6 sticky top-0 z-50">
         <div className="flex items-center gap-3">
            <div className="bg-gradient-primary text-white p-2 rounded-xl shadow-lg shadow-indigo-500/20">
               <Hexagon size={20} strokeWidth={3} />
            </div>
            <div>
               <h1 className="text-lg font-black tracking-tight text-slate-800 leading-none">
                 HELIOS <span className="text-transparent bg-clip-text bg-gradient-to-r from-violet-600 to-cyan-500">ARCHITECT</span>
               </h1>
               <span className="text-[10px] font-bold text-slate-400 tracking-widest uppercase">Intelligent Mine Design</span>
            </div>
         </div>
         <div className="flex items-center gap-4">
            <div className="hidden md:flex items-center gap-2 px-3 py-1 bg-slate-100 rounded-full text-xs font-medium text-slate-500 border border-slate-200/50">
               <Cpu size={14} className="text-violet-500" /> AI Core: V2.4
            </div>
            <GlassButton variant="secondary" icon={Save}>Save Project</GlassButton>
            <div className="w-10 h-10 rounded-full bg-slate-200 border-2 border-white shadow-sm overflow-hidden">
               <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Architect" alt="User" />
            </div>
         </div>
      </header>

      {/* Main Workspace */}
      <div className="flex-1 flex overflow-hidden relative">
        
        {/* LEFT: Parameters Panel (Floating & Compact) */}
        <div className={`absolute left-4 top-4 bottom-4 z-30 transition-all duration-300 ease-[cubic-bezier(0.25,0.8,0.25,1)] flex flex-col ${leftPanelOpen ? 'w-72' : 'w-0 pointer-events-none'}`}>
           <div className={`flex-1 glass-panel rounded-2xl flex flex-col overflow-hidden shadow-2xl transition-opacity duration-300 ${leftPanelOpen ? 'opacity-100' : 'opacity-0'}`}>
              
              {/* Panel Header */}
              <div className="p-5 border-b border-white/60 bg-white/40 flex justify-between items-center">
                 <span className="text-xs font-black text-slate-700 uppercase tracking-wider flex items-center gap-2">
                    <Settings size={14} className="text-violet-500"/> 地质参数设定
                 </span>
                 <button onClick={() => setLeftPanelOpen(false)} className="text-slate-400 hover:text-violet-600 transition-colors"><X size={16}/></button>
              </div>
              
              <div className="flex-1 overflow-y-auto p-5 space-y-6 custom-scroll">
                 {/* Input Group 1 */}
                 <div className="bg-white/40 p-3 rounded-xl border border-white/60 shadow-sm">
                    <h3 className="text-[10px] font-bold text-slate-400 uppercase mb-3 flex items-center gap-2"><Layers size={12}/> 煤层条件</h3>
                    <ParameterInput label="平均埋深" unit="m" defaultValue={450} min={100} max={1200} />
                    <ParameterInput label="煤层厚度" unit="m" defaultValue={3.5} min={0.8} max={20.0} />
                    <ParameterInput label="煤层倾角" unit="°" defaultValue={5} min={0} max={45} />
                 </div>

                 {/* Input Group 2 */}
                 <div className="bg-white/40 p-3 rounded-xl border border-white/60 shadow-sm">
                    <h3 className="text-[10px] font-bold text-slate-400 uppercase mb-3 flex items-center gap-2"><Ruler size={12}/> 岩石力学</h3>
                    <ParameterInput label="顶板硬度 (f)" unit="" defaultValue={6.5} min={1} max={12} />
                    <ParameterInput label="底板比压" unit="MPa" defaultValue={2.4} min={0.5} max={10} />
                 </div>

                 {/* Input Group 3 */}
                 <div className="bg-white/40 p-3 rounded-xl border border-white/60 shadow-sm">
                    <h3 className="text-[10px] font-bold text-slate-400 uppercase mb-3 flex items-center gap-2"><Zap size={12}/> 灾害指标</h3>
                    <div className="flex items-center gap-2 bg-amber-50/50 p-2 rounded border border-amber-100/50 mb-3">
                       <Zap size={12} className="text-amber-500"/>
                       <span className="text-xs font-bold text-amber-700/80">高瓦斯矿井</span>
                    </div>
                    <ParameterInput label="瓦斯涌出" unit="m³/t" defaultValue={4.2} min={0} max={30} />
                 </div>
              </div>

              {/* Generate Button */}
              <div className="p-5 bg-white/60 border-t border-white/60">
                 <button 
                    onClick={handleGenerate}
                    className="w-full py-3 rounded-xl bg-gradient-primary text-white font-bold text-sm shadow-xl shadow-indigo-500/30 hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2 relative overflow-hidden group"
                    disabled={isGenerating}
                 >
                    {isGenerating ? (
                        <>
                           <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                           <span>AI 计算中...</span>
                        </>
                    ) : (
                        <>
                           <Sparkles size={16} className="animate-pulse" />
                           <span>生成设计规程</span>
                           <ArrowRight size={16} className="group-hover:translate-x-1 transition-transform" />
                        </>
                    )}
                 </button>
              </div>
           </div>
        </div>

        {/* Toggle for Left Panel */}
        {!leftPanelOpen && (
           <button 
             onClick={() => setLeftPanelOpen(true)}
             className="absolute left-4 top-4 z-20 p-2.5 bg-white/80 backdrop-blur border border-white rounded-xl shadow-lg text-slate-500 hover:text-violet-600 transition-all hover:scale-105"
             title="Open Parameters"
           >
             <PanelLeftOpen size={20} />
           </button>
        )}

        {/* CENTER: Canvas Area */}
        <main className="flex-1 relative bg-slate-50/30 overflow-hidden">
           {/* Floating Toolbar (Glass Style) */}
           <div className="absolute top-6 left-1/2 -translate-x-1/2 glass-panel px-4 py-2 rounded-full shadow-sm flex items-center gap-4 z-10 scale-95 border border-white/60">
              <button className="p-1.5 hover:bg-violet-50 rounded-full text-slate-500 hover:text-violet-600 transition-colors"><MousePointer2 size={18} /></button>
              <button className="p-1.5 hover:bg-violet-50 rounded-full text-slate-500 hover:text-violet-600 transition-colors"><Move size={18} /></button>
              <div className="w-px h-5 bg-slate-200"></div>
              <button className="p-1.5 hover:bg-violet-50 rounded-full text-slate-500 hover:text-violet-600 transition-colors"><PenTool size={18} /></button>
              <button className="p-1.5 hover:bg-violet-50 rounded-full text-slate-500 hover:text-violet-600 transition-colors"><Ruler size={18} /></button>
              <div className="w-px h-5 bg-slate-200"></div>
              <button className="p-1.5 hover:bg-violet-50 rounded-full text-slate-500 hover:text-violet-600 transition-colors"><Maximize2 size={18} /></button>
           </div>
           
           {/* CAD Canvas Component */}
           <BlueprintCanvas isGenerating={isGenerating} showDesign={showResult} />
        </main>

        {/* RIGHT: Report Panel (Docked but collapsible) */}
        <aside 
          className={`
            bg-white/80 backdrop-blur-xl border-l border-white/60 transition-all duration-500 ease-in-out flex flex-col z-20 relative shadow-xl
            ${rightPanelOpen ? 'w-80 translate-x-0' : 'w-0 translate-x-full opacity-0 overflow-hidden'}
          `}
        >
           <div className="h-14 border-b border-white/60 flex items-center justify-between px-5 bg-white/40">
              <div className="flex items-center gap-2">
                 <FileText className="text-cyan-600" size={18} />
                 <h2 className="text-sm font-bold text-slate-800">设计说明书</h2>
              </div>
              <button onClick={() => setRightPanelOpen(false)} className="text-slate-400 hover:text-violet-600 transition-colors"><PanelRightClose size={18}/></button>
           </div>

           <div className="flex-1 overflow-y-auto p-6 custom-scroll">
              {showResult ? (
                <div className="space-y-8 animate-fadeIn">
                   <div className="bg-emerald-50/80 border border-emerald-100 rounded-xl p-4 flex items-start gap-3 shadow-sm">
                      <CheckCircle2 size={18} className="text-emerald-600 mt-0.5 shrink-0" />
                      <div>
                         <div className="text-xs font-bold text-emerald-800">规程已生成</div>
                         <p className="text-[10px] text-emerald-600/80 leading-tight mt-1">基于地质参数 V2.4 模型优化完毕。</p>
                      </div>
                   </div>

                   {/* Sections */}
                   <div>
                      <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 border-b border-slate-100 pb-1 pl-1">01. 矿井开拓</h3>
                      <div className="space-y-1">
                         <SpecItem label="开拓类型" value="立井多水平" />
                         <SpecItem label="主井深度" value="482.5 m" />
                         <SpecItem label="年产量" value="4.00 Mt/a" />
                      </div>
                   </div>

                   <div>
                      <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 border-b border-slate-100 pb-1 pl-1">02. 采煤工艺</h3>
                      <p className="text-xs text-slate-600 leading-relaxed text-justify mb-3 bg-white p-3 rounded-lg border border-white shadow-sm">
                         基于煤层厚度分析，推荐采用 <span className="font-bold text-violet-600">综采一次采全高</span> 工艺。
                      </p>
                      <div className="space-y-1">
                         <SpecItem label="支架选型" value="ZY12000/28/62D" />
                         <SpecItem label="采高范围" value="2.8 - 6.2 m" />
                      </div>
                   </div>

                   <div>
                      <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3 border-b border-slate-100 pb-1 pl-1">03. 安全专篇</h3>
                      <div className="bg-amber-50/50 p-3 rounded-lg border border-amber-100/50">
                         <div className="flex gap-2 mb-1 text-amber-600 font-bold text-xs items-center">
                            <Zap size={12} /> 高瓦斯防治措施
                         </div>
                         <p className="text-[10px] text-amber-700/70 leading-relaxed">
                            强制执行 "U+L" 型通风方式，并在工作面回风巷设置专用回风巷。
                         </p>
                      </div>
                   </div>
                </div>
              ) : (
                <div className="h-full flex flex-col items-center justify-center text-slate-300 space-y-4">
                   <div className="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center border border-slate-100">
                      <FileText size={32} className="text-slate-200" />
                   </div>
                   <div className="text-center">
                      <p className="text-sm font-bold text-slate-400">待生成</p>
                      <p className="text-[10px] mt-1 text-slate-400">请在左侧设置参数并点击生成</p>
                   </div>
                </div>
              )}
           </div>

           <div className="p-5 border-t border-white/60 bg-white/40 flex flex-col gap-3 backdrop-blur-md">
              <GlassButton variant="primary" className="w-full justify-center" icon={Download}>下载完整规程 (PDF)</GlassButton>
              <div className="grid grid-cols-2 gap-3">
                 <GlassButton variant="secondary" className="justify-center" icon={Printer}>打印</GlassButton>
                 <GlassButton variant="secondary" className="justify-center" icon={Share2}>分享</GlassButton>
              </div>
           </div>
        </aside>

        {/* Toggle for Right Panel */}
        {!rightPanelOpen && (
           <button 
             onClick={() => setRightPanelOpen(true)}
             className="absolute right-4 top-4 z-20 p-2.5 bg-white/80 backdrop-blur border border-white rounded-xl shadow-lg text-slate-500 hover:text-violet-600 transition-all hover:scale-105"
             title="Open Report"
           >
             <PanelRightOpen size={20} />
           </button>
        )}

      </div>
    </div>
  );
}